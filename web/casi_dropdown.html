{% extends "appbuilder/base.html" %}

{% block content %}
<div class="container-fluid">
    <h3>CASI Tool: Cyclical Adversarial Stepwise Improvement</h3>
    <p>The Generator's output is automatically used as the Critic's input for the next step.</p>
    <hr>
    <form method="POST">
        <div class="row">
            <div class="col-md-12">
                <h4><i class="fa fa-key"></i> API Keys (Optional)</h4>
                <p><small>Choose from your saved API keys, or enter a new one. Keys are stored in your session and not saved on the server. Leave blank to use the site's default configuration (if available).</small></p>
            </div>
            <div class="col-md-5">
                <div class="form-group">
                    <label for="openai_api_key">OpenAI API Key:</label>
                    <select class="form-control" name="openai_api_key">
                        <option value="">-- Select a saved key --</option>
                        {% for key in openai_keys %}
                        <option value="{{ key.api_key }}" {% if key.is_default %}selected{% endif %}>{{ key.key_name }}{% if key.is_default %} (default){% endif %}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-5">
                <div class="form-group">
                    <label for="anthropic_api_key">Anthropic API Key:</label>
                    <select class="form-control" name="anthropic_api_key">
                        <option value="">-- Select a saved key --</option>
                        {% for key in anthropic_keys %}
                        <option value="{{ key.api_key }}" {% if key.is_default %}selected{% endif %}>{{ key.key_name }}{% if key.is_default %} (default){% endif %}</option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group" style="margin-top: 25px;">
                     <button type="submit" name="action" value="save_keys" class="btn btn-secondary btn-block">Save Keys</button>
                </div>
            </div>
        </div>
        <hr>
        <!-- Download trace section -->
        <div class="row">
            <div class="col-md-8">
                <p>
                    <small>
                        Download a text trace of the Generator/Critic conversation
                        for this session.
                    </small>
                </p>
            </div>
            <div class="col-md-4 text-right">
                <button type="submit"
                        name="action"
                        value="download_trace"
                        class="btn btn-primary"
                        {% if not has_history %}disabled{% endif %}>
                    Download Trace (Text)
                </button>
            </div>
        </div>
    </form>
</div>
{% endblock %}

